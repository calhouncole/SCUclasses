<div ng-controller="courseOptionsCtrl" class="container-fluid">

  <div id="schedule" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>{{schedulename}}</h3>
    </div>
    <div class="modal-body">
      <p ng-show="sectionsAdded().length == 0">No classes added.</p>
      <div ng-show="sectionsAdded().length > 0">
        <table class="table-striped table-bordered table-condensed">
          <thead>
          <tr>
            <th>Class</th>
            <th>Name</th>
            <th>Class ID</th>
            <th>Professor</th>
            <th>Days</th>
            <th>Times</th>
            <th>Location</th>
            <th>Units</th>
          </tr>
          </thead>
          <tr ng-repeat="section in sectionsAdded()" ng-show="section.selected">
            <td>{{section.name}}</td>
            <td>{{section.fullname}}</td>
            <td><a href="http://www.scu.edu/courseavail/class/?fuseaction=details&class_nbr={{section.id}}&term=<%= TERM %>" title="Opens the CourseAvail listing for this section" target="_blank">{{section.id}}</a></td>
            <td><a class="course-evaluation" data-professor="{{section.instructors}}" title="Opens course evaluations for this professor">{{section.instructors}}</a></td>
            <td>{{section.days}}</td>
            <td>{{section.time_start.formatted}} - {{section.time_end.formatted}}</td>
            <td>{{section.location}}</td>
            <td>{{section.units}}</td>
          </tr>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <a href="/export.csv?sections={{sectionIds()}}" class="btn btn-success"><i class="icon-download-alt icon-white"></i> Download Schedule</a>
      <button class="btn" data-dismiss="modal">Close</button>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span6">
      <div class="top">
        <h1>SCU&#8226;Classes</h1>

        <button data-toggle="modal" data-target="#schedule" class="btn btn-primary btn-small"><i class="icon-th-list icon-white"></i> Schedule Info</button>
        <a href="/export.csv?sections={{sectionIds()}}&name={{schedulename}}" class="btn btn-success btn-small"><i class="icon-download-alt icon-white"></i> Download Schedule</a>
        <button ng-click="clearCourses()" class="btn btn-danger btn-small"><i class="icon-remove-sign icon-white"></i> Clear Schedule</button>

        <br><br>

        <div class="input-prepend">
          <span class="add-on">Schedule Name</span>
          <input ng-model="schedulename" class="input-large input-name" type="text">
        </div>

        <br>

        <input ng-model="addCourseText" class="input-course" type="text" placeholder='Type a class, like "RSOC 9"'/>
        <strong>OR</strong>
        <select ng-change="addCourseCore()" ng-model="selectedcore" ng-options="value.name as value.fullname for value in core"></select>

        <div class="welcome hide-{{hideWelcomeMessage()}}">
          <h3>Welcome to SCU&#8226;Classes.</h3>
          <h3>It's like CourseAvail on steroids.</h3>
          <h4>To get started, name your schedule and add a class using the boxes above.</h4>
        </div>

        <div ng-show="coursesAdded() == 1" class="alert alert-info">
          <button type="button" class="close" data-dismiss="alert">&times;</button>
          <p>Now that you've added a class:</p>
          <ul>
            <li>Click on a section to add it to your schedule.  Conflicting classes are disabled.</li>
            <li>Look at summary of your schedule, or download your schedule as an Excel file using the buttons above</li>
            <li>Click the <button class="btn btn-mini" title="Expand/collapse this class"><i class="icon-circle-arrow-up"></i></button> button to collapse a class, and the <button class="btn btn-mini" title="Remove this class"><i class="icon-remove-sign"></i></button> button to delete a class</li>
            <li>Watch your schedule's unit count on the right.  Normally, you can register for a max of 19 units.</li>
            <li>All of the information on this website comes from CourseAvail and is updated at the top of every hour</li>
          </ul>
        </div>
      </div>

      <div ng-repeat="course in courses | orderBy:'number':true" class="course course-{{course.number}} show-{{course.show}}">
        <div class="inner">
          <h4>
            <div class="btn-group">
              <button ng-click="toggleExpand(course)" class="btn btn-small" title="Expand/collapse this class"><i class="{{expandArrow(course)}}"></i></button>
              <button ng-click="removeCourse(course)" class="btn btn-small" title="Remove this class"><i class="icon-remove-sign"></i></button>
            </div>
            {{course.nameandfullname}}
          </h4>
          <div ng-repeat="section in course.sections" class="section selected-{{section.selected}} validchoice-{{isValidChoice(section)}}" data-original-title="{{section.invalidbecause}}" rel="tooltip">
            <label for="section-{{section.id}}">
              <table>
                <tbody>
                <tr>
                  <td class="select">
                    <input ng-model="section.selected" id="section-{{section.id}}" type="checkbox" ng-disabled="!isValidChoice(section)">
                  </td>
                  <td class="name" ng-show="course.iscore">
                    {{section.name}}
                  </td>
                  <td class="schedule">
                    <span class="days">{{section.days}}</span>
                    <br>
                    <span class="times">{{section.time_start.formatted}} - {{section.time_end.formatted}}</span>
                  </td>
                  <td class="seats">
                    <span class="seats">{{section.seats}}</span>
                    <br>
                    <span class="remaining">seat{{plural(section.seats)}} remaining</span>
                  </td>
                  <td class="moreinfo">
                    <a class="btn btn-mini" rel="popover" data-original-title="{{section.fullname}}" data-content="{{popoverInfo(section)}}">More Info</a>
                    <span ng-show="section.islab" class="label label-info">lab section</span>
                  </td>
                  <td class="info">
                    <span><strong>Name:</strong> {{section.fullname}}</span>
                    <br>
                    <span><strong>Class ID:</strong> <a href="http://www.scu.edu/courseavail/class/?fuseaction=details&class_nbr={{section.id}}&term=<%= TERM %>" title="Opens the CourseAvail listing for this section" target="_blank">{{section.id}}</a></span>
                    <br>
                    <span><strong>Professor:</strong> <a class="course-evaluation" data-professor="{{section.instructors}}" title="Opens course evaluations for this professor">{{section.instructors}}</a></span>
                  </td>
                </tr>
                </tbody>
              </table>
            </label>
          </div>
          <p class="scroll"><a><i class="icon-arrow-up"></i>Scroll to top</a></p>
        </div>
      </div>
    </div>


    <div class="span6">
      <div class="calendar">
        <div class="days">
          <div class="hours">
            <% @hours.each do |h| %>
              <div class="hour"><%= ((h < 13) ? (h) : (h - 12)).to_s + ((h < 12) ? 'am' : 'pm') %></div>
            <% end %>
          </div>

          <% @days.each do |d,day| %>
            <div class="day" id="<%= d %>">
              <div class="day-title"><%= day %></div>
              <% @hours[0..(@hours.length - 3)].each do |h| %>
                <div class="hour"></div>
              <% end %>
              <div class="hour last"></div>

              <div ng-repeat="course in courses">
                <div ng-repeat="section in course.sections">
                  <div ng-show="showSectionBlock(section, '<%= d %>')" class="course-block course-{{course.number}}" style="top:{{section.style.top}}; height:{{section.style.height}};">
                    <label for="section-{{section.id}}">&times;</label>
                    <div class="name">{{section.name}}</div>
                    <div class="times">{{section.time_start.formatted}} - {{section.time_end.formatted}}</div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <div class="bottom">
          <p>This schedule has <strong class="green-{{units() <= 19}}">{{units()}}</strong> unit{{plural(units())}} || Updated from CourseAvail <strong class="green-true">{{lastupdated}}</strong> minute{{plural(lastupdated)}} ago</p>
        </div>
      </div>
      <div class="spacer"></div>
    </div>
  </div>
</div>








<script type="text/javascript">
    var js_courses = <%= raw @js_courses.to_json %>;
    var js_term = <%= TERM %>;
    var js_lastupdated = <%= @lastupdated %>;
</script>

<form id="course-evaluation-form" action="http://evaluations.scu.edu/" method="post" target="_blank">
  <input name="fac" type="hidden">
</form>
